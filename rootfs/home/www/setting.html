<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>路由配置</title>
    <style>
        .styled-select select {
            background: transparent;
            width: 268px;
            padding: 5px;
            font-size: 16px;
            border: 1px solid #ccc;
            height: 34px;
            -webkit-appearance: none; /*for chrome*/
        }
    </style>
    <link rel="stylesheet" href="./layui/css/layui.css">
</head>
<body>
    <form class="layui-form">
        <div style="padding:100px;background-image:url(./bg.png);" class="layui-form">
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">IP地址</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="ip" name="" lay-verify="required" placeholder="请输入IP地址" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px;">MAC地址</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="mac" lay-verify="required" name="" placeholder="请输入MAC地址" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">网络选择</label>
                <div class="layui-input-inline" style="width:300px">
                    <select name="" id="mode"  class="styled-select" lay-ignore style="width:300px;height:38px">
                        <option value="">请选择</option>
                        <option value="0">自动</option>
                        <option value="1">GSM</option>
                        <option value="2">WCDMA</option>
                        <option value="3">LTE</option>
                        <option value="4">TDS-CDMA</option>
                        <option value="5">CDMA</option>
                        <option value="6">EVDO</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">升级周期</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="cycle" lay-verify="required" name="" placeholder="请输入升级周期" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">FTP地址</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="ftp" lay-verify="required" name="" placeholder="请输入FTP地址" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">FTP端口号</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="ftp_port" lay-verify="required" name="" placeholder="请输入FTP端口号" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">设备信号</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="rssi" lay-verify="" name="" placeholder="" autocomplete="off" class="layui-input" readonly>
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">联网状态</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="status" lay-verify="" name="" placeholder="" autocomplete="off" class="layui-input" readonly>
                </div>
            </div>
            <div class="layui-form-item" style="padding:20px;width:100%;text-align:center">
                <label class="layui-form-label" style="width:200px;padding-left:500px">设备状态</label>
                <div class="layui-input-inline" style="width:300px">
                    <input type="text" id="device_status" lay-verify="" name="" placeholder="" autocomplete="off" class="layui-input" readonly>
                </div>
            </div>

            <div style="text-align:center">
                <a lay-submit lay-filter="submit" class="layui-btn">提交</a>
                <a lay-submit lay-filter="reset" class="layui-btn">重启</a>
                <a lay-submit lay-filter="device" class="layui-btn">设备检测</a>
            </div>
            <div style="height:300px">

            </div>
        </div>

    </form>


    <script src="./layui/layui.js"></script>
    <script src="./layui/jquery-1.8.2.js"></script>
    <script>



        $(document).ready(function () {
            layui.use(['layer', 'form'], function () {
                var layer = layui.layer
                , form = layui.form();

                form.on('submit(submit)', function (data) {
                    submit();
                });
                form.on('submit(reset)', function (data) {

                    layer.confirm('是否确认重启', {icon: 3, title:'提示'}, function(index){
                        reset();
                        layer.close(index);
                    });
          
                });
                form.on('submit(device)', function (data) {
                    device();
                });


                var query = location.search.substring(1);//获取查询串
                var arrquery = query.split("&");
                var data2 = 'name=' + arrquery[0] + '&pasw=' + arrquery[1];
                $.ajax({
                    type: "get",
                    url: '../cgi-bin/parse.cgi?' + data2,
                    data: {},
                    success: function (data) {
                        var obj = jQuery.parseJSON(data);
                        //alert('返回来的数据是:' + obj.ip_addr);

                        $('#ip').val(obj.ip_addr);
                        $('#mac').val(obj.mac_addr);
                        $('#mode').val(obj.pref_mode.toString());
                        $('#cycle').val(obj.update_cycle);
                        $('#ftp').val(obj.ftp_addr);
                        $('#ftp_port').val(obj.ftp_port);
                        $('#rssi').val(obj.rssi);
                        $('#status').val(obj.status);
                        
                    }
                });


                $.ajax({
                    type: "get",
                    url: '../cgi-bin/query.cgi?' + data2,
                    data: {},
                    success: function (data) {
                        $('#device_status').val(data);
                    }
                });
                //form.render();
            });
        });

        
        function device() {
           
            $.ajax({
                type: "get",
                url: '../cgi-bin/query.cgi',
                data: {},
                success: function (data) {
                    $('#device_status').val(data);
                }
            });
        }



        function submit() {
            var ip = $('#ip').val();
            var mac = $('#mac').val();
            var mode = $('#mode').val();
            var cycle = $('#cycle').val();
            var ftp = $('#ftp').val();
            var ftp_port = $('#ftp_port').val();
            var update = ip + '&' + mac + '&' + mode + '&' + cycle + '&' + ftp + "&" + ftp_port;
            $.ajax({
                type: "get",
                url: '../cgi-bin/update.cgi?' + update,
                data: {},
                success: function (data) {
                    layer.msg('设置成功重启生效');
                }
            });
        }

        function reset() {
         
            $.ajax({
                type: "get",
                url: '../cgi-bin/update.cgi?RESET',
                data: {},
                success: function (data) {
                    layer.msg('重启成功');
                }
            });
        }

    </script>

</body>
</html>
